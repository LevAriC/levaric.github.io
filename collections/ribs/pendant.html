<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIBS Pendant â€” Omer Zimmerman Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/ribs.css">
</head>
<body>
    <!-- Floating Home Button -->
    <a href="../../index.html" class="floating-home" title="Home">
        <img src="../../Assets/Logo/oz-logo-png.png" alt="Omer Zimmermann Logo" class="floating-logo">
        <span class="home-tooltip">Home</span>
    </a>

    <!-- Text-only Back Link -->
    <a class="back-link" href="#" aria-label="Go back">Back</a>

    <div class="product-layout">
        <div class="product-gallery">
            <img src="../../Assets/ribs/pandent/ribs-pendant-600-birch.jpg" alt="RIBS Pendant 600mm in birch">
        </div>

        <div class="product-info">
            <h1 class="product-title">RIBS Pendant</h1>
            <p class="product-description">A floating light that brings warmth to any space. Perfect for dining areas and kitchen islands, alone or in clusters.</p>

            <div class="product-selector">
                <div class="selector-group">
                    <h3 class="selector-label">Size</h3>
                    <div class="selector-options">
                        <div class="selector-option" data-size="400">400 mm</div>
                        <div class="selector-option" data-size="600">600 mm</div>
                    </div>
                </div>

                <div class="selector-group">
                    <h3 class="selector-label">Material</h3>
                    <div class="selector-options">
                        <div class="selector-option" data-material="birch">Birch</div>
                        <div class="selector-option" data-material="aluminum">Aluminum</div>
                        <div class="selector-option" data-material="perspex">Frosted Perspex</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const options = document.querySelectorAll('.selector-option');
            const productImage = document.querySelector('.product-gallery img');
            const gallery = document.querySelector('.product-gallery');
            
            // Set default values
            let currentSize = '600';
            let currentMaterial = 'birch';
            
            // Zoom functionality
            let scale = 1;
            let translateX = 0;
            let translateY = 0;
            let isDragging = false;
            let startX, startY;
            
            // Set initial active states
            document.querySelector('[data-size="600"]').classList.add('active');
            document.querySelector('[data-material="birch"]').classList.add('active');
            
            // Update image based on selections
            function updateProductImage() {
                // Ensure material is lowercase
                const material = currentMaterial.toLowerCase();
                // Construct the correct image path
                const imagePath = `../../Assets/ribs/pandent/ribs-pendant-${currentSize}-${material}.jpg`;
                
                // Update image source and alt text
                productImage.src = imagePath;
                productImage.alt = `RIBS Pendant ${currentSize}mm in ${material}`;
                
                // Optional: Handle loading errors
                productImage.onerror = function() {
                    console.error(`Failed to load image: ${imagePath}`);
                    // Fallback to default if image fails to load
                    this.src = '../../Assets/ribs/pandent/ribs-pendant-600-birch.jpg';
                    this.alt = 'RIBS Pendant 600mm in birch';
                };
            }
            
            // Set initial image
            updateProductImage();
            
            options.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove active class from siblings
                    const siblings = this.parentElement.querySelectorAll('.selector-option');
                    siblings.forEach(sib => sib.classList.remove('active'));
                    
                    // Add active class to clicked option
                    this.classList.add('active');
                    
                    // Update current selection
                    if (this.hasAttribute('data-size')) {
                        currentSize = this.getAttribute('data-size');
                    } else if (this.hasAttribute('data-material')) {
                        currentMaterial = this.getAttribute('data-material').toLowerCase();
                    }
                    
                    // Update the product image
                    updateProductImage();
                });
            });

            // Zoom functions
            function updateTransform() {
                productImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
            }

            function resetZoom() {
                scale = 1;
                translateX = 0;
                translateY = 0;
                gallery.classList.remove('zoomed');
                updateTransform();
            }

            // Wheel zoom handler
            gallery.addEventListener('wheel', (e) => {
                e.preventDefault();
                const rect = gallery.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                
                // Calculate zoom
                const delta = -Math.sign(e.deltaY) * 0.1;
                const newScale = Math.min(Math.max(1, scale + delta), 4);
                
                if (newScale !== scale) {
                    // Calculate cursor position relative to image
                    const scaleChange = newScale - scale;
                    translateX -= (mouseX - translateX) * (scaleChange / scale);
                    translateY -= (mouseY - translateY) * (scaleChange / scale);
                    
                    scale = newScale;
                    
                    // Update cursor and transform
                    gallery.classList.toggle('zoomed', scale > 1);
                    updateTransform();
                }
            });

            // Mouse drag functionality
            gallery.addEventListener('mousedown', (e) => {
                if (scale > 1) {
                    isDragging = true;
                    startX = e.clientX - translateX;
                    startY = e.clientY - translateY;
                    gallery.style.cursor = 'grabbing';
                }
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    translateX = e.clientX - startX;
                    translateY = e.clientY - startY;
                    
                    // Constrain panning
                    const maxTranslateX = (scale - 1) * gallery.offsetWidth / 2;
                    const maxTranslateY = (scale - 1) * gallery.offsetHeight / 2;
                    
                    translateX = Math.min(Math.max(-maxTranslateX, translateX), maxTranslateX);
                    translateY = Math.min(Math.max(-maxTranslateY, translateY), maxTranslateY);
                    
                    updateTransform();
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                gallery.style.cursor = scale > 1 ? 'move' : 'zoom-in';
            });

            // Reset zoom when changing images
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    resetZoom();
                }
            });
        });

        // Deterministic back link behavior
        (function(){
            const link = document.querySelector('.back-link');
            if(!link) return;

            const RIBS_COLLECTION_URL = 'https://omerzimer.com/collections/ribs.html';
            const HOME_PATH = '/';

            // Normalize current path
            const path = location.pathname.replace(/\/index\.html$/i, '').toLowerCase();

            // Detect pages
            const isHome =
                document.body.classList.contains('page-home') ||
                document.body.classList.contains('home') ||
                path === '/' ;

            // Consider these as "RIBS collection" pages (local or deployed)
            const isRibsCollection =
                path === '/ribs' || path === '/ribs/' ||
                path.endsWith('/collections/ribs.html');

            // Any deeper RIBS subpage (pendant/wall/strip), in either style of routing:
            const isRibsSubpage =
                /^\/ribs\/(pendant|wall|strip)(\/|\.html|$)/i.test(path) ||
                /\/collections\/ribs\/(pendant|wall|strip)(\/|\.html|$)/i.test(path) ||
                /\/ribs-(pendant|wall|strip)\.html$/i.test(path);

            function parentPath(p){
                const parent = p.replace(/\/[^\/]+\/?$/, '') || '/';
                return parent;
            }

            // Compute deterministic target (no history.back)
            function computeTarget(){
                if (isHome) return null;                              // no Back on Home
                if (isRibsSubpage) return RIBS_COLLECTION_URL;        // RIBS subpages -> your URL
                if (isRibsCollection) return HOME_PATH;               // RIBS collection -> Home
                return parentPath(path);                              // generic fallback
            }

            const target = computeTarget();

            if (!target || (target === path)) {
                link.remove(); // nothing meaningful to do
                return;
            }

            // Update href so it still works if JS is slow/blocked
            link.setAttribute('href', target);

            // Click -> navigate to target
            link.addEventListener('click', function(ev){
                ev.preventDefault();
                window.location.assign(target);
            });
        })();
    </script>
</body>
</html>
